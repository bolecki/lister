{% extends 'lists/base.html' %}

{% load staticfiles %}

{% block title %}{{ lister }}{% endblock %}

{% block startscript %}
function update(id, action){
  var url = "{% url 'lists:vote' list_id=list_id item_id=12345 action='abcdef' %}";

  url = url.replace('12345', id);
  url = url.replace('abcdef', action);

  $.post(url, function(data){
    $("#lister-items").html(data);
  });
}
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ lister }}   <button class="btn btn-xs btn-warning" type="button" id="toggle-edit">Edit</button></h1>
</div>

<div class="row">
    <div class="col-lg-3 col-md-6">
        <h4 id="selected"></h4>
    </div>
</div>

<div class="row" id="lister-items">
Loading...
</div>

<div class="row">
    <div class="col-lg-3 col-md-6">
        <form role="form" class="edit" action="{% url 'lists:lister' list_id %}" method="post">
            {% csrf_token %}
            <div class="form-group">
                <label>Add Item</label>
                <input class="form-control" type="text" name="add" id="add" value="" />
            </div>
            <div class="form-group">
                <button class="btn btn-xs btn-primary" type="submit">Add</button>
            </div>
        </form>
    </div>
</div>

{% if mine %}
<div class="row">
    <div class="col-sm-3">
        <form role="form" class="edit" action="{% url 'lists:grant' list_id %}" method="post">
            <b>Grant Users Access:</b>
            <div class="form-group">
                {% csrf_token %}
                {{ grant_form }}
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-sm btn-primary">Grant</button>
            </div>
        </form>
    </div>
</div>
<div class="row">
    <div class="col-sm-3">
        <button type="submit" class="edit btn btn-sm btn-primary" onclick="update({{ items.0.id }}, 'clear')">Clear Votes</button>
    </div>
</div>
{% endif %}

<script src="{% static 'lists/sortable.min.js' %}"></script>

{% endblock %}

{% block endscript %}
$(document).ready(function(){
  $.get("{% url 'lists:part' list_id=list_id %}", function(data){
    $("#lister-items").html(data);
  });

  $("#toggle-edit").click(function(){
    if($(".edit").css('visibility') == 'hidden'){
      $(".edit").css('visibility', 'visible');
    }else{
      $(".edit").css('visibility', 'hidden');
    }
  });

  (function poll() {
    setTimeout(function() {
      $.ajax({ url: "{% url 'lists:part' list_id=list_id %}", success: function(data) {
        $("#lister-items").html(data);
      }, complete: poll });
    }, 10000);
  })();

});
{% endblock %}
