{% load list_extras %}

<div class="col-lg-6">
    <div id="sortList" class="list-group">
        {% if items %}
            {% for item in items %}
                <div class="list-group-item">
                    <button class="close edit" onclick="update({{ item.id }}, 'delete')" type=submit>&times;</button>
                    {% if not voted %}
                        {% if not sortable %}
                        <button class="btn btn-xs btn-primary" onclick="update({{ item.id }}, 'up')" type=submit>&plus;</button>
                        {% endif %}
                    {% else %}
                        {% if item.item_text == voted %}
                            <button class="btn btn-xs btn-danger" onclick="update({{ item.id }}, 'down')" type=submit>&minus;</button>
                        {% endif %}
                    {% endif %}
                    <span title="{{ item.users.all|usernames }}"> {{ item.votes }} {{ item.item_text }}</span>
                </div>
            {% endfor %}
        {% endif %}
    </div>
    {% if not sortable %}
    <div class="col-lg-12">
        <button class="btn btn-xs btn-primary" id="random">Random</button>
        {% if items.0.votes == items.1.votes %}
            <button class="btn btn-xs btn-primary" id="tie-breaker">Tie Breaker</button>
        {% endif %}
    </div>
    {% endif %}
</div>
<!-- /.col-sm-4 -->
{% if num_votes %}
<div class="col-lg-3 col-md-6">
    <div class="panel panel-primary">
        <div class="panel-heading">
            <div class="row">
                <div class="col-xs-3">
                    <i class="fa fa-check-square fa-5x"></i>
                </div>
                <div class="col-xs-9 text-right">
                    <div class="huge">{{ num_votes.votes__sum }}</div>
                    <div>Votes</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="col-lg-3 col-md-6"></div>
{% endif %}
<div class="col-lg-3 col-md-6">
    <div class="panel panel-primary">
        <div class="panel-heading">
            <div class="row">
                <div class="col-xs-3">
                    <i class="fa fa-list fa-5x"></i>
                </div>
                <div class="col-xs-9 text-right">
                    <div class="huge">{{ items|length }}</div>
                    <div>Items</div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

{% if sortable %}
Sortable.create(sortList, {
  animation: 150,
  onEnd: function (/**Event*/evt) {
    var url = "{% url 'lists:sort' list_id=list_id old_index=99999 new_index=99998 %}";

    url = url.replace('99999', evt.oldIndex);
    url = url.replace('99998', evt.newIndex);

    $.post(url, function(){});
  },
});

{% else %}

$("#random").click(function(){
  $("#selected").html("Loading...");
  $.get("{% url 'api:random' list_id=list_id %}", function(data){
    $("#selected").html(data);
  });
});

$("#tie-breaker").click(function(){
  $("#selected").html("Loading...");
  $.get("{% url 'api:random' list_id=list_id option='tie' %}", function(data){
    $("#selected").html(data);
  });
});
{% endif %}
</script>
